<html>
    <head>
        <!--Web3.js required to sign transaction-->
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
    </head>
    <body>
        <script>
            function signTx(opType){
                let web3js = new Web3();
                //Getting filled values
                let addressFromInput = document.getElementById('addressFromInput');
                let addressToInput = document.getElementById('addressToInput');
                let amountInput = document.getElementById('amountInput');
                let privateKeyInput = document.getElementById('privateKeyInput');
                
                //Send request to prepare operation of opType type from specified address
                let req = new XMLHttpRequest();
                req.open('POST', `/net/orbs/address/${addressFromInput.value}/transactions/prepare-${opType}`);
                req.setRequestHeader('Content-Type', 'application/json');
                req.send(JSON.stringify({
                    toAddress: addressToInput.value,
                    amount: amountInput.value
                }));
                //On response...
                req.onloadend = () => {
                    console.log('response:', req.responseText);
                    //Parse response from JSON
                    let tx = JSON.parse(req.responseText);
                    //Private key should start with 0x
                    let privateKey = privateKeyInput.value;
                    if(!privateKey.startsWith('0x')){
                        privateKey = '0x' + privateKey;
                    }
                    //Sign prepared transaction with privateKey
                    web3js.eth.accounts.signTransaction(tx, privateKey).then(signedTx => {
                        console.log('signedTx:', signedTx);
                        //Send signed transaction
                        req.open('POST', `/net/orbs/address/${addressFromInput.value}/transactions/send`);
                        req.setRequestHeader('Content-Type', 'application/json');
                        req.send(JSON.stringify({signedTransaction: signedTx.rawTransaction}));
                        //On response display added transaction hash
                        req.onloadend = () => alert('Sent! Hash: ' + req.responseText);
                    });
                };
            }

        </script>
        <div style="display: flex; flex-direction: column;">
            <input id="addressFromInput" placeholder="address from"/>
            <input id="privateKeyInput" placeholder="private key"/>
            <input id="addressToInput" placeholder="address to"/>
            <input id="amountInput" placeholder="amount"/>
            <button onclick="signTx('transfer')">Sign&Transfer</button>        
            <button onclick="signTx('delegation')">Sign&Delegate</button>        
        </div>
    </body>
</html>